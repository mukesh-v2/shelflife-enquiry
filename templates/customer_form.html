<!DOCTYPE html>
<html>
<head>
    <title>Shelf Life Study Enquiry</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .form-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .form-wrapper {
            width: 100%;
            max-width: 900px;
            position: relative;
        }
        
        .form-header {
            background-color: #60ae56; /* Brand green */
            text-align: center;
            padding: 20px 0;
            border-radius: 10px 10px 0 0;
            z-index: 10;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .brand-logo {
            max-height: 80px;
            margin: 0 auto 10px;
            display: block;
        }
        
        .form-heading {
            color: white;
            font-weight: 700;
            margin: 0;
            font-size: 1.8rem;
        }
        
        .form-card {
            border-top-left-radius: 0 !important;
            border-top-right-radius: 0 !important;
            margin-top: -1px; /* Ensures seamless connection */
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            z-index: 5;
            padding: 20px;
        }
        
        .section-card {
            margin-bottom: 20px;
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .section-card .card-header {
            background-color: #2b57a5; /* Brand blue */
            font-size: 1.2rem;
            padding: 12px 20px;
        }
        
        .required-label::after {
            content: " *";
            color: #e32;
        }
        
        .btn-brand-lg {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .product-section {
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
        }
        
        .remove-product {
            color: #dc3545;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .add-product {
            margin-top: 20px;
        }
        
        .custom-select {
            padding: 10px 20px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            background-color: white;
            width: 100%;
            font-size: 0.9rem;
            color: #495057;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23343a40' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px 16px;
            overflow: visible !important;
            min-height: 41px;
        }
        
        .custom-select:focus {
            border-color: #60ae56;
            box-shadow: 0 0 0 0.2rem rgba(96, 174, 86, 0.25);
            outline: none;
        }
        
        .custom-select option {
            color: #495057;
            font-size: 0.9rem;
            padding: 5px 15px;
        }
          .custom-select-box {
        padding: 8px 12px;
        font-size: 16px;
        line-height: 1.5;
        height: auto;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .custom-select-box option {
        font-size: 16px;
        padding: 8px;
    }

    .form-group label.required-label {
        font-weight: 600;
        margin-bottom: 6px;
        display: block;
    }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-wrapper">
            <!-- Header with logo -->
            <div class="form-header">
                <img src="{{ url_for('static', filename='envirocare_logo.png') }}" 
                     alt="Envirocare Logo" 
                     class="brand-logo">
                <h2 class="form-heading">Shelf Life Study Enquiry Form</h2>
            </div>
            
            <!-- Form card -->
            <div class="card form-card">
                <form action="/customer_form" method="POST" id="enquiryForm">
                    <!-- Contact Information -->
                    <div class="card section-card">
                        <div class="card-header">Contact Information</div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="required-label">Company Name</label>
                                <input type="text" name="company" class="form-control" required>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="required-label">Contact Person</label>
                                        <input type="text" name="contact_person" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="required-label">Designation</label>
                                        <input type="text" name="designation" class="form-control" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="required-label">Contact Number</label>
                                        <input type="tel" name="phone" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="required-label">Email ID</label>
                                        <input type="email" name="email" class="form-control" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Information (Dynamic) -->
                    <div class="card section-card">
                        <div class="card-header">Product Information</div>
                        <div class="card-body">
                            <div id="productContainers">
                                <!-- First product section -->
                                <div class="product-section" id="product1">
                                    <div class="float-right">
                                        <span class="remove-product" onclick="removeProduct(1)">Remove Product</span>
                                    </div>
                                    <div class="form-group">
                                        <label class="required-label">Product Name</label>
                                        <input type="text" name="product_name[]" class="form-control" required>
                                    </div>

                                    <div class="form-group">
                                        <label class="required-label">List of Ingredients</label>
                                        <small style="color: gray; display: block; margin-top: 1px; margin-bottom: 1px;">
                                            Major Ingredients (more than 5%)
                                        </small>
                                          <small style="color: gray; display: block; margin-top: 1px; margin-bottom: 1px;">
                                            All submitted information will be kept strictly confidential and used only for study purposes
                                        </small>  
                                        <textarea name="ingredients[]" class="form-control" rows="3" required></textarea>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="required-label">Product Category *</label>
                                                <select name="category[]" class="form-control custom-select" required>
                                                    <option value="" selected disabled>-- Select Category --</option>
                                                    <option value="Dairy Products & Analogues">Dairy Products & Analogues</option>
                                                    <option value="Fats, Oils and Fat Emulsions">Fats, Oils and Fat Emulsions</option>
                                                    <option value="Fruit and Vegetable Products">Fruit and Vegetable Products</option>
                                                    <option value="Cereal and Cereal Products">Cereal and Cereal Products</option>
                                                    <option value="Sweets and Confectionary">Sweets and Confectionary</option>
                                                    <option value="Sweetening agents including Honey">Sweetening agents including Honey</option>
                                                    <option value="Salt, Spices condiments and Related Products">Salt, Spices condiments and Related Products</option>
                                                    <option value="Beverages (Other than Dairy & Fruits and Vegetable Based)">Beverages (Other than Dairy & Fruits and Vegetable Based)</option>
                                                    <option value="Other Food Products and Ingredients">Other Food Products and Ingredients</option>
                                                    <option value="Proprietary Food">Proprietary Food</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="required-label">Packaging Material</label>
                                                <input type="text" name="packaging[]" class="form-control" required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label class="required-label">Sample Quantity (Weight)</label>
                                                <input type="text" name="quantity[]" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label class="required-label">Packaging Dimensions</label>
                                                <input type="text" name="dimensions[]" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Expected Shelf Life</label>
                                                <input type="text" name="expected_shelf_life[]" class="form-control">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="required-label">Storage Conditions *</label>
                                        <div class="form-check">
                                            <input class="form-check-input storage-condition" type="radio" name="storage_condition_1" value="ambient" id="ambient1" checked>
                                            <label class="form-check-label" for="ambient1">Ambient</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input storage-condition" type="radio" name="storage_condition_1" value="refrigerated" id="refrigerated1">
                                            <label class="form-check-label" for="refrigerated1">Refrigerated</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input storage-condition" type="radio" name="storage_condition_1" value="frozen" id="frozen1">
                                            <label class="form-check-label" for="frozen1">Frozen</label>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="required-label">Specific Temperature/Humidity Requirements</label>
                                        <select name="temp_humidity[]" class="form-control custom-select" required>
                                            <option value="" selected disabled>-- Select Requirement --</option>
                                            <option value="ambient-real-time">Real Time: 25℃ 60%RH</option>
                                            <option value="ambient-accelerated">Accelerated: 40℃ 75%RH</option>
                                            
                                            <option value="refrigerated-real-time" style="display: none;">Real Time: 1 to 4℃</option>
                                            
                                            <option value="frozen-real-time" style="display: none;">Real Time: -18℃</option>
                                            <option value="other" style="display: none;">Other</option>
                                        </select>
                                        <input type="text" name="custom_temp_humidity[]" class="form-control" style="display: none;">
                                    </div>

                                    <div class="form-group">
                                        <label>Number of Pull Outs</label>
                                        <input type="text" name="pullout[]" class="form-control">
                                    </div>

                                    <!-- Study Details for this product -->
                                    <div class="form-group">
                                        <label class="required-label">Reason for Shelf Life Testing</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="reason_1" value="New Product" id="new_product_1" required>
                                            <label class="form-check-label" for="new_product_1">New Product</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="reason_1" value="Change in Formula" id="formula_change_1">
                                            <label class="form-check-label" for="formula_change_1">Change in Formula/Ingredients/Processing/Packaging</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="reason_1" value="Verification" id="verification_1">
                                            <label class="form-check-label" for="verification_1">Verification of Current Shelf Life</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="reason_1" value="FSSA" id="fssa_1">
                                            <label class="form-check-label" for="fssa_1">FSSA (Non-compliance Case)</label>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="required-label">Analysis Type</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="analysis_type_1" value="Microbiological" id="micro_1">
                                            <label class="form-check-label" for="micro_1">Microbiological</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="analysis_type_1" value="Chemical" id="chemical_1">
                                            <label class="form-check-label" for="chemical_1">Chemical</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="analysis_type_1" value="Sensory" id="sensory_1">
                                            <label class="form-check-label" for="sensory_1">Sensory</label>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>Label Claims (if any)</label>
                                        <textarea name="label_claims_1" class="form-control" rows="3"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-primary add-product" onclick="addProduct()">Add Another Product</button>
                        </div>
                    </div>

                    <form>
                        <div class="text-center mt-4">
                        <button type="submit" id="submitBtn" class="btn btn-brand btn-brand-lg">Submit Enquiry</button>
                    </div>
                    </form>
                </form>
            </div>
        </div>
    </div>

    <script>
        let productCount = 1;

        const form=document.querySelector('form')
        const submitBtn = document.getElementById('submitBtn')

        form.addEventListener('submit', function (e) {
            console.log("Hello");
            submitBtn.disabled = true
            submitBtn.textContent = 'Submitting...'
        })

        
        function addProduct() {
            productCount++;
            const productContainers = document.getElementById('productContainers');
            const newProductSection = document.createElement('div');
            newProductSection.className = 'product-section';
            newProductSection.id = `product${productCount}`;
            
            newProductSection.innerHTML = `
                <div class="float-right">
                    <span class="remove-product" onclick="removeProduct(${productCount})">Remove Product</span>
                </div>
                <div class="form-group">
                    <label class="required-label">Product Name</label>
                    <input type="text" name="product_name[]" class="form-control" required>
                </div>

                <div class="form-group">
                    <label class="required-label">List of Ingredients</label>
                     <small style="color: gray; display: block; margin-top: 1px; margin-bottom: 1px;">
                                            Major Ingredients (more than 5%)
                                        </small>
                                          <small style="color: gray; display: block; margin-top: 1px; margin-bottom: 1px;">
                                            All submitted information will be kept strictly confidential and used only for study purposes
                                        </small>  
                    <textarea name="ingredients[]" class="form-control" rows="3" required></textarea>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-label">Product Category *</label>
                            <select name="category[]" class="form-control custom-select" required>
                                <option value="" selected disabled>-- Select Category --</option>
                                <option value="Dairy Products & Analogues">Dairy Products & Analogues</option>
                                <option value="Fats, Oils and Fat Emulsions">Fats, Oils and Fat Emulsions</option>
                                <option value="Fruit and Vegetable Products">Fruit and Vegetable Products</option>
                                <option value="Cereal and Cereal Products">Cereal and Cereal Products</option>
                                <option value="Sweets and Confectionary">Sweets and Confectionary</option>
                                <option value="Sweetening agents including Honey">Sweetening agents including Honey</option>
                                <option value="Salt, Spices condiments and Related Products">Salt, Spices condiments and Related Products</option>
                                <option value="Beverages (Other than Dairy & Fruits and Vegetable Based)">Beverages (Other than Dairy & Fruits and Vegetable Based)</option>
                                <option value="Other Food Products and Ingredients">Other Food Products and Ingredients</option>
                                <option value="Proprietary Food">Proprietary Food</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="required-label">Packaging Material</label>
                            <input type="text" name="packaging[]" class="form-control" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-label">Sample Quantity (Weight)</label>
                            <input type="text" name="quantity[]" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="required-label">Packaging Dimensions</label>
                            <input type="text" name="dimensions[]" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Expected Shelf Life</label>
                            <input type="text" name="expected_shelf_life[]" class="form-control">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required-label">Storage Conditions *</label>
                    <div class="form-check">
                        <input class="form-check-input storage-condition" type="radio" name="storage_condition_${productCount}" value="ambient" id="ambient${productCount}" checked>
                        <label class="form-check-label" for="ambient${productCount}">Ambient</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input storage-condition" type="radio" name="storage_condition_${productCount}" value="refrigerated" id="refrigerated${productCount}">
                        <label class="form-check-label" for="refrigerated${productCount}">Refrigerated</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input storage-condition" type="radio" name="storage_condition_${productCount}" value="frozen" id="frozen${productCount}">
                        <label class="form-check-label" for="frozen${productCount}">Frozen</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required-label">Specific Temperature/Humidity Requirements</label>
                    <select name="temp_humidity[]" class="form-control custom-select" required>
                        <option value="" selected disabled>-- Select Requirement --</option>
                        <option value="ambient-real-time">Real Time: 25℃ 60%RH</option>
                        <option value="ambient-accelerated">Accelerated: 40℃ 75%RH</option>
                        
                        <option value="refrigerated-real-time" style="display: none;">Real Time: 1 to 4℃</option>
                        
                        <option value="frozen-real-time" style="display: none;">Real Time: -18℃</option>
                        <option value="other" style="display: none;">Other</option>
                    </select>
                    <input type="text" name="custom_temp_humidity[]" class="form-control" style="display: none;">
                </div>

                <div class="form-group">
                    <label>Number of Pull Outs</label>
                    <input type="text" name="pullout[]" class="form-control">
                </div>

                <!-- Study Details for this product -->
                <div class="form-group">
                    <label class="required-label">Reason for Shelf Life Testing</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="reason_${productCount}" value="New Product" id="new_product_${productCount}" required>
                        <label class="form-check-label" for="new_product_${productCount}">New Product</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="reason_${productCount}" value="Change in Formula" id="formula_change_${productCount}">
                        <label class="form-check-label" for="formula_change_${productCount}">Change in Formula/Ingredients/Processing/Packaging</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="reason_${productCount}" value="Verification" id="verification_${productCount}">
                        <label class="form-check-label" for="verification_${productCount}">Verification of Current Shelf Life</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="reason_${productCount}" value="FSSA" id="fssa_${productCount}">
                        <label class="form-check-label" for="fssa_${productCount}">FSSA (Non-compliance Case)</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required-label">Analysis Type</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="analysis_type_${productCount}" value="Microbiological" id="micro_${productCount}">
                        <label class="form-check-label" for="micro_${productCount}">Microbiological</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="analysis_type_${productCount}" value="Chemical" id="chemical_${productCount}">
                        <label class="form-check-label" for="chemical_${productCount}">Chemical</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="analysis_type_${productCount}" value="Sensory" id="sensory_${productCount}">
                        <label class="form-check-label" for="sensory_${productCount}">Sensory</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Label Claims (if any)</label>
                    <textarea name="label_claims_${productCount}" class="form-control" rows="3"></textarea>
                </div>
            `;
            
            productContainers.appendChild(newProductSection);
            const selectedStorage = newProductSection.querySelector(`input[name="storage_condition_${productCount}"]:checked`);
            if (selectedStorage) {
                updateTempHumidityOptions(newProductSection, selectedStorage.value);
            }

            // ✅ Attach change listener to the new storage condition radios
            newProductSection.querySelectorAll(`input[name="storage_condition_${productCount}"]`).forEach(radio => {
                radio.addEventListener("change", function () {
                    updateTempHumidityOptions(newProductSection, this.value);
                });
            });
            
            // Initialize the new product's temp/humidity dropdown
        }
        
        function removeProduct(productId) {
            const productElement = document.getElementById(`product${productId}`);
            productElement.remove();
            
            // Update IDs of remaining products
            const products = document.querySelectorAll('.product-section');
            products.forEach((product, index) => {
                product.id = `product${index + 1}`;
                const removeSpan = product.querySelector('.remove-product');
                removeSpan.onclick = function() { removeProduct(index + 1); };
                
                // Update storage condition radio button names
                const storageRadios = product.querySelectorAll('.storage-condition');
                storageRadios.forEach(radio => {
                    radio.name = `storage_condition_${index + 1}`;
                });
                
                // Update study details field names
                const studyFields = product.querySelectorAll('[name^="reason_"], [name^="analysis_type_"], [name^="label_claims_"]');
                studyFields.forEach(field => {
                    const oldName = field.name;
                    const newSuffix = index + 1;
                    const newId = field.id.replace(/\d+$/, newSuffix);
                    
                    field.name = oldName.replace(/\d+$/, newSuffix);
                    field.id = newId;
                });
            });
        }
        
        // Temperature/humidity requirements functionality
        document.addEventListener('DOMContentLoaded', function() {
            const productSections = document.querySelectorAll('.product-section');
            productSections.forEach((section, index) => {
                const storageRadios = section.querySelectorAll('.storage-condition');
                storageRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        updateTempHumidityOptions(section, this.value);
                    });
                });
                const firstRadio = section.querySelector('.storage-condition:checked') || section.querySelector('.storage-condition');
                if (firstRadio) {
                    updateTempHumidityOptions(section, firstRadio.value);
                }
            });
        });
        function updateTempHumidityOptions(section, storageCondition) {
        const tempHumiditySelect = section.querySelector('select[name="temp_humidity[]"]');
        const customTempInput = section.querySelector('input[name="custom_temp_humidity[]"]');

        const previousValue = tempHumiditySelect.value;

        // Hide all options except the placeholder
        tempHumiditySelect.querySelectorAll('option').forEach(option => {
            if (option.value !== '') {
                option.style.display = 'none';
            }
        });

        const showOptions = [];
        if (storageCondition === 'ambient') {
            showOptions.push('ambient-real-time', 'ambient-accelerated', 'other');
        } else if (storageCondition === 'refrigerated') {
            showOptions.push('refrigerated-real-time', 'other');
        } else if (storageCondition === 'frozen') {
            showOptions.push('frozen-real-time', 'other');
        }

        showOptions.forEach(value => {
            const option = tempHumiditySelect.querySelector(`option[value="${value}"]`);
            if (option) option.style.display = 'block';
        });

        if (!showOptions.includes(previousValue)) {
            tempHumiditySelect.value = '';
            customTempInput.style.display = 'none';
        } else {
            tempHumiditySelect.value = previousValue;
            customTempInput.style.display = (previousValue === 'other') ? 'block' : 'none';
        }

        if (!tempHumiditySelect.dataset.listenerAttached) {
            tempHumiditySelect.addEventListener('change', function () {
                if (this.value === 'other') {
                    customTempInput.style.display = 'block';
                } else {
                    customTempInput.style.display = 'none';
                }
            });
            tempHumiditySelect.dataset.listenerAttached = "true";
        }
    }

    document.getElementById("enquiryForm").addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent actual form submission

        const products = [];
        const form = document.getElementById("enquiryForm");
        const contactInfo = {
            company: form.querySelector('input[name="company"]').value,
            contact_person: form.querySelector('input[name="contact_person"]').value,
            designation: form.querySelector('input[name="designation"]').value,
            phone: form.querySelector('input[name="phone"]').value,
            email: form.querySelector('input[name="email"]').value
        };
        const guide=""

        document.querySelectorAll(".product-section").forEach((section, index) => {
            const tempHumiditySelect = section.querySelector('select[name="temp_humidity[]"]');
            const selectedOption = tempHumiditySelect.options[tempHumiditySelect.selectedIndex];

            const product = {
                product_name: section.querySelector('input[name="product_name[]"]').value,
                ingredients: section.querySelector('textarea[name="ingredients[]"]').value,
                category: section.querySelector('select[name="category[]"]').value,
                packaging: section.querySelector('input[name="packaging[]"]').value,
                quantity: section.querySelector('input[name="quantity[]"]').value,
                dimensions: section.querySelector('input[name="dimensions[]"]').value,
                expected_shelf_life: section.querySelector('input[name="expected_shelf_life[]"]').value,
                storage_condition: section.querySelector(`input[name="storage_condition_${index + 1}"]:checked`)?.value,
                temp_humidity: tempHumiditySelect.value,
                temp_humidity_label: selectedOption ? selectedOption.textContent : "",
                custom_temp_humidity: section.querySelector('input[name="custom_temp_humidity[]"]').value,
                pullout: section.querySelector('input[name="pullout[]"]').value,
                reason: section.querySelector(`input[name="reason_${index + 1}"]:checked`)?.value,
                analysis_type: Array.from(section.querySelectorAll(`input[name="analysis_type_${index + 1}"]:checked`)).map(el => el.value),
                label_claims: section.querySelector(`textarea[name="label_claims_${index + 1}"]`)?.value || ""
            };

            products.push(product);
        });
        console.log(products)

        fetch('/customer_form', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ contact_info: contactInfo, products: products,guide:guide })
        })
        .then(response => {
            if (!response.ok) throw new Error("Network response was not ok");
            return response.json();
        })
        .then(data => {
            if (data.redirect_url) {
                window.location.href = data.redirect_url;
            } else {
                alert("Form submitted successfully.");
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("There was an error submitting the form.");
        });
    });

    </script>
</body>
</html>